# 招生智能体需求验证测试计划（2026-02-15）

## 1. 目标与范围
- 基线文档：`docs/需求分析.md`
- 测试对象：`client/`（Vue3）+ `server/`（FastAPI）
- 目标：
  - 验证核心业务可用性（用户端 + 管理端）
  - 验证前后端联调链路（通过浏览器访问前端并走代理调用 API）
  - 发现阻断性缺陷后立即修复并回归

## 2. 测试环境
- 日期：2026-02-15
- 前端：Vite dev server `http://127.0.0.1:5173`
- 后端：Uvicorn `http://127.0.0.1:8000`
- 数据库：PostgreSQL 15（本地）
- 缓存：Redis 7（本地）

## 3. 测试策略
- 静态核对：需求条目映射到代码实现与路由。
- 自动化基线：
  - 后端：`cd server && . .venv/bin/activate && pytest -q`
  - 前端：`cd client && npx vue-tsc --noEmit && npm run build`
- 联调验证（模拟浏览器真实行为）：
  - 访问前端入口 `GET /`
  - 通过前端代理路径 `/api/v1/...` 完成用户与管理员关键流程
  - 检查 HTTP 状态码、JSON 字段和关键业务副作用
- 缺陷闭环：复现 -> 修复 -> 全量回归。

## 4. 需求覆盖测试清单
1. 用户手机号短信登录
- 用例：发送短信验证码、验证码登录、读取 `me`。
- 预期：成功返回 token，用户资料可读取。

2. 智能对话核心链路
- 用例：创建会话、改名、发送高风险问题（SSE）。
- 预期：返回 `high_risk` 事件并给出官方引导话术；消息入库可查。

3. 幻觉防控与风险机制
- 用例：高风险关键词触发拦截；敏感词管理接口可访问。
- 预期：高风险触发固定回复；管理员可维护敏感词组。

4. 知识库管理流程
- 用例：上传文档 -> 列表查询 -> 审核通过 -> 归档。
- 预期：状态流转正确（`pending -> approved -> archived`）。

5. 多媒体管理流程
- 用例：上传官方图片 -> 列表查询 -> 审批 -> 删除。
- 预期：全流程成功。

6. 管理后台权限与运维接口
- 用例：管理员登录后访问 dashboard/roles/permissions/users/logs/models/calendar。
- 预期：超管均可访问，返回 200。

7. 前端构建与类型稳定性
- 用例：`vue-tsc`、`vite build`。
- 预期：命令成功。

## 5. TodoList（执行与完成记录）
- [x] 阅读需求与开发文档（`docs/需求分析.md`、`docs/quick-start.md`）
- [x] 执行后端自动化测试（27/27 通过）
- [x] 执行前端类型检查与构建（通过）
- [x] 启动 PostgreSQL/Redis/Uvicorn/Vite 联调环境
- [x] 执行用户端联调（短信登录、会话、聊天 SSE）
- [x] 执行管理端联调（仪表盘、角色权限、用户、敏感词、模型、日历、日志）
- [x] 执行知识库上传与审核链路联调
- [x] 执行多媒体上传与审批链路联调
- [x] 修复阻断缺陷（权限种子缺失导致多后台接口 403）
- [x] 缺陷修复后全量回归（后端测试、前端构建、联调脚本全部通过）

## 6. 缺陷记录（本轮）
- 缺陷：管理员多个路由依赖的权限码未在种子数据中创建，导致超管访问被错误拒绝（403）。
- 影响：`/admin/dashboard/*`、`/admin/roles`、`/admin/permissions`、`/admin/sensitive/*`、`/admin/users/{id}/ban` 等功能可用性受阻。
- 修复：更新 `server/app/core/seed.py`，改为幂等补齐模式并补充缺失资源/动作权限，保证默认超管权限完整。
- 验证：修复后联调相关接口均返回 200，且全量回归通过。
